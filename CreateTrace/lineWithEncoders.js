var __interpretation_started_timestamp__;
var k = 0;
var k1 = 0;
var v = 70;
var kturn = 0.8;
var retPeriod = 10;
	

function move(left, right) {
  var K = 0.75;
  var v1 = 60;
  var int = 0;
  var ci = 0.05;
  var sV = 30;

  var leftEnc = brick.encoder("B4");
  var rightEnc = brick.encoder("B3");

  var leftM = brick.motor(M4);
	var rightM = brick.motor(M3);

	leftM.setPower(0);
	rightM.setPower(0);

  var l = leftEnc.readRawData();  
  var r = rightEnc.readRawData();
  
  var diffl = left - l;
  var diffr = r - right;
  var cl = 0, cr = 0;
    
  if (diffl < diffr) { 
    cl = diffl * 1.0 / diffr;
    cr = 1;
  } else {
  	cl = 1;
  	cr = diffr * 1.0 / diffl;
  } 

  print("coeff: " + cl + ", " + cr);

  while (l < left && r > right) {
    
    l = leftEnc.readRawData();
    r = rightEnc.readRawData();
    print(l + ", " + r);
    diffl = left - l;
    diffr = right - r;
    var diff = diffl * cr + diffr * cl;

    var u = K * diff + int;

    rightM.setPower(v1 - u);
    leftM.setPower(v1 + u);
    
    print(u);
    script.wait(retPeriod);
    l = leftEnc.readRawData();
    r = rightEnc.readRawData();
  }

  leftM.setPower(101);
  rightM.setPower(101);
  while (l < left) {
    if (l - left <= diffEncs)
    	leftM.setPower(sV);
    else
      leftM.setPower(v1);
    script.wait(retPeriod);
    l = leftEnc.readRawData();
  } 
  while (r > right) {
    if (right - r <= diffEncs)
    	rightM.setPower(sV);
    else
      rightM.setPower(v1);
    script.wait(retPeriod);
    r = rightEnc.readRawData();
  } 

  leftM.setPower(101);
  rightM.setPower(101);
} 

function moveStraight(left, right) {
  var K = 0.7;
  var v1 = 70;
  var int = 0;
  var ci = 0.7;

  var leftEnc = brick.encoder("B4");
  var rightEnc = brick.encoder("B3");

  var leftM = brick.motor(M4);
	var rightM = brick.motor(M3);

	leftM.setPower(0);
	rightM.setPower(0);

  var l = leftEnc.readRawData();  
  var r = rightEnc.readRawData();
  var diffl = l - left;
  var diffr = r - right;

  while (l < left && r > right) {
    l = leftEnc.readRawData();
    r = rightEnc.readRawData();
    diffl = left - l;
    diffr = right - r;
    var diff = diffl + diffr;

    int += ci * diff;
    var u = K * diff + int;
    rightM.setPower(v1 - u);
    leftM.setPower(v1 + u);
    
    script.wait(retPeriod);
    l = leftEnc.readRawData();
    r = rightEnc.readRawData();
  } 

  leftM.setPower(0);
  rightM.setPower(0);
} 

function stop() {
  print("Stopped!");
  var leftM = brick.motor(M1);
	var rightM = brick.motor(M2);

	while (true) {
	  leftM.setPower(0);
	  rightM.setPower(0);
	}
}
  
var main = function()
{
  __interpretation_started_timestamp__ = Date.now();
  print("Hello");

  var leftEnc = brick.encoder("B4");
  var rightEnc = brick.encoder("B3");
  leftEnc.reset();
  rightEnc.reset();

  var leftM = brick.motor(M4);
	var rightM = brick.motor(M3);

	//var lArr = [0,0,0,0,0,4,23,45,72,95,124,164,193,223,239,244,249,267,307,334,366,401,448,480,501,508,512,514,535,572,596,623,641,660,682,707,735,763,786,801,818,838,874,921,954,985,1011,1037,1057,1080,1101,1123,1141,1168,1196,1226,1250,1278,1304,1329,1363,1390,1413,1434,1452,1468,1493,1524,1549,1580,1615,1654,1685,1710,1734,1769,1799,1827,1850,1876,1904,1933,1964,1991,2020,2046,2071,2096,2122,2149,2177,2205,2234,2263,2292,2316,2342,2366,2398,2430,2460,2493,2520,2547,2575,2603,2629,2658,2684,2713,2744,2774,2801,2833,2872,2908,2946,2972,2990,3008,3028,3046,3061,3076,3086,3093,3109,3134,3164,3187,3217,3252,3288,3337,3377,3421,3465,3503,3541,3577,3608,3639,3669,3685,3688,3688,3688,3688,3693,3718,3755,3815,3874,3911,3944,3958,3961,3963,3963,3967,3985,4023,4070,4120,4155,4183,4210,4235,4262,4297,4325,4360,4386,4419,4451,4475,4499,4520,4540,4554,4570,4588,4610,4636,4661,4688,4711,4735,4760,4783,4806,4833,4858,4883,4903,4931,4952,4979,4999,5018,5035,5053,5072,5097,5123,5145,5171,5192,5212,5227,5248,5269,5297,5332,5361,5385,5402,5422,5437,5455,5471,5487,5505,5526,5542,5564,5588,5608,5631,5655,5679,5708,5733,5760,5783,5809,5834,5860,5885,5909,5932,5942,5945,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5949,5952,5970,5989,6023,6034,6035,6035,6036,6036,6036];
  //var rArr = [-4,-12,-25,-38,-56,-85,-109,-119,-123,-125,-125,-128,-143,-165,-203,-243,-290,-336,-367,-378,-384,-387,-390,-409,-448,-481,-521,-573,-612,-650,-663,-670,-673,-674,-677,-689,-708,-736,-772,-806,-843,-870,-901,-933,-958,-988,-1012,-1041,-1067,-1092,-1114,-1134,-1150,-1174,-1200,-1234,-1262,-1296,-1322,-1343,-1372,-1401,-1432,-1465,-1499,-1527,-1562,-1590,-1610,-1632,-1658,-1688,-1714,-1737,-1753,-1774,-1802,-1835,-1866,-1895,-1918,-1942,-1967,-1988,-2011,-2034,-2056,-2080,-2103,-2128,-2151,-2175,-2198,-2220,-2240,-2256,-2273,-2286,-2302,-2315,-2334,-2361,-2390,-2415,-2437,-2458,-2475,-2495,-2512,-2531,-2552,-2573,-2590,-2611,-2636,-2657,-2678,-2691,-2695,-2698,-2698,-2698,-2698,-2698,-2698,-2698,-2703,-2716,-2732,-2746,-2763,-2782,-2797,-2811,-2819,-2824,-2833,-2843,-2858,-2871,-2885,-2899,-2915,-2929,-2945,-2967,-2989,-3011,-3043,-3062,-3073,-3075,-3077,-3091,-3109,-3127,-3145,-3165,-3193,-3232,-3255,-3275,-3289,-3296,-3302,-3319,-3340,-3364,-3388,-3412,-3430,-3449,-3467,-3491,-3514,-3535,-3558,-3578,-3607,-3633,-3658,-3684,-3712,-3734,-3749,-3765,-3785,-3807,-3831,-3852,-3872,-3896,-3919,-3938,-3957,-3980,-3999,-4026,-4053,-4085,-4117,-4148,-4174,-4198,-4220,-4239,-4269,-4303,-4343,-4370,-4407,-4436,-4461,-4489,-4510,-4530,-4552,-4576,-4597,-4622,-4644,-4662,-4684,-4705,-4721,-4743,-4768,-4792,-4818,-4847,-4877,-4912,-4942,-4974,-5001,-5034,-5065,-5094,-5124,-5150,-5178,-5193,-5209,-5230,-5251,-5266,-5281,-5296,-5307,-5316,-5325,-5334,-5344,-5353,-5365,-5376,-5388,-5398,-5412,-5424,-5439,-5450,-5460,-5471,-5482,-5493,-5508,-5524,-5540,-5553,-5568,-5585,-5603,-5624,-5664,-5690,-5709,-5727,-5734,-5733,-5734,-5734,-5734,-5734];
  var lArr = [0,0,0,0,5,27,44,67,86,122,161,193,216,222,224,225,226,239,264,308,357,404,443,472,486,493,496,497,499,516,555,587,622,656,692,719,731,734,736,753,784,822,860,888,909,917,921,922,928,955,983,1007,1028,1048,1076,1112,1141,1155,1157,1161,1180,1206,1245,1295,1335,1365,1388,1397,1398,1398,1401,1414,1449,1497,1539,1568,1581,1584,1585,1587,1602,1631,1663,1696,1723,1739,1758,1779,1795,1819,1849,1873,1905,1932,1951,1961,1970,1986,2004,2031,2070,2114,2147,2169,2183,2201,2220,2248,2271,2296,2318,2342,2371,2392,2408,2421,2435,2455,2490,2526,2562,2589,2618,2642,2667,2694,2728,2770,2810,2847,2887,2910,2933,2947,2962,2972,2986,2996,3007,3014,3031,3049,3074,3102,3132,3153,3172,3188,3206,3231,3263,3310,3359,3396,3431,3464,3504,3542,3573,3607,3640,3671,3696,3726,3754,3781,3804,3826,3850,3873,3894,3913,3932,3958,3984,4011,4041,4070,4103,4123,4142,4156,4170,4189,4210,4238,4269,4296,4320,4341,4366,4390,4416,4442,4463,4488,4509,4530,4551,4574,4592,4610,4630,4650,4676,4701,4724,4748,4772,4794,4814,4842,4870,4897,4925,4946,4968,4990,5014,5036,5053,5069,5097,5128,5167,5208,5241,5266,5280,5285,5292,5309,5334,5367,5403,5434,5461,5483,5499,5507,5514,5534,5562,5598,5634,5662,5683,5687,5698,5720,5756,5795,5834,5869,5895,5916,5933,5952,5974,5992,5995,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5996,5997,5997,5997,5997,5997,5999];
  var rArr = [-4,-12,-27,-49,-76,-93,-99,-100,-100,-105,-112,-129,-159,-182,-212,-237,-265,-291,-310,-326,-336,-349,-378,-412,-439,-471,-495,-526,-577,-614,-632,-638,-640,-643,-657,-677,-714,-751,-787,-817,-830,-838,-844,-859,-886,-907,-937,-972,-1017,-1049,-1063,-1068,-1070,-1070,-1070,-1074,-1105,-1152,-1196,-1226,-1256,-1277,-1290,-1300,-1315,-1341,-1374,-1405,-1429,-1453,-1477,-1499,-1515,-1519,-1523,-1541,-1571,-1603,-1640,-1684,-1723,-1741,-1750,-1753,-1756,-1764,-1789,-1819,-1847,-1869,-1886,-1892,-1895,-1910,-1941,-1975,-2008,-2040,-2058,-2068,-2072,-2080,-2098,-2126,-2177,-2217,-2241,-2257,-2263,-2266,-2266,-2268,-2277,-2291,-2316,-2349,-2376,-2397,-2415,-2423,-2433,-2451,-2475,-2501,-2528,-2554,-2582,-2607,-2631,-2646,-2665,-2675,-2681,-2684,-2687,-2689,-2689,-2689,-2689,-2689,-2690,-2703,-2719,-2735,-2751,-2759,-2763,-2766,-2768,-2768,-2769,-2779,-2795,-2812,-2832,-2853,-2875,-2897,-2913,-2932,-2952,-2971,-2988,-3009,-3030,-3051,-3071,-3092,-3118,-3145,-3168,-3189,-3211,-3239,-3266,-3287,-3308,-3329,-3352,-3364,-3369,-3372,-3373,-3374,-3380,-3395,-3413,-3430,-3448,-3463,-3482,-3499,-3517,-3538,-3555,-3578,-3597,-3617,-3637,-3661,-3680,-3698,-3715,-3730,-3749,-3764,-3781,-3799,-3817,-3835,-3852,-3878,-3903,-3930,-3956,-3979,-4002,-4024,-4049,-4077,-4116,-4155,-4202,-4231,-4249,-4263,-4285,-4316,-4368,-4420,-4455,-4487,-4511,-4531,-4543,-4554,-4569,-4588,-4619,-4657,-4693,-4721,-4738,-4753,-4769,-4797,-4839,-4888,-4938,-4971,-4995,-5016,-5042,-5067,-5097,-5126,-5154,-5185,-5210,-5230,-5251,-5270,-5291,-5309,-5327,-5339,-5352,-5364,-5376,-5387,-5399,-5411,-5422,-5432,-5445,-5459,-5474,-5487,-5502,-5517,-5530,-5542,-5552,-5564,-5576,-5588,-5600,-5613,-5623,-5635,-5647,-5661,-5678];

  //var lArr = [100, 200, 400, 800];
  //var rArr = [-100, -200, -400, -800];
  //var lArr = [2000];
  //var rArr = [-2000];

  for (var i = 0; i < lArr.length; i += 5) {
     move(lArr[i], rArr[i]);
  } 

  leftM.setPower(101);
  rightM.setPower(101);
 
  print("end");
}
